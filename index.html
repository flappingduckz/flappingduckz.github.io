<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>WEATHER APP</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <script src=https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.3.0/math.min.js></script>
    <script type="text/javascript">
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script>
    $(function() {
            $("#MainICON").hover(
                function() {
                    $(this).attr("src", "IMG/11_rain.gif");
                },
                function() {
                    setTimeout($(this).attr("src", "IMG/11_rain.png"),  511000) 
                    
                }
            );
        });
    </script>
  </head>
  <body style="background-color:#74d5e8;">
    <div class="container bg-white">
      <div class="row">
        <div class="col-4 m-4 STATS">
          
          <h2 ><u id="LOC">Current Location : No where</u></h2>
          <h1 class="TEMP"><b id="currentTimes"> 0:00PM Tuesday</b><br>Temperature:<b id="TEMPATURED"></b></h1>
          <h3 class="HUM">Humidity : <b id="HUMIDITY">0</b>%</h3>
          <h3 class="WIND">Wind : <b id="WINDINESS">0</b> MPH</h3>
          <h3 class="RAIN">Raining : Meatballs</h3>
          <h3 class="CHANCE">Chance of Prec: <b id="ChanceOfRain">0</b>%</h3>
        </div>
        <div class="col-5">
          <img class="mt-5" src="IMG/11_rain.png" alt="" id="MainICON">
        </div>
        <div class="WeatherPopup" id="Popup1" style="width: 950px">
        <h1>im tmrws forcast</h1>  
        </div>
        <div class="WeatherPopup" id="Popup2" style="width: 950px">
          <h1>im tmrws 2 forcast</h1>
        </div>
        <div class="WeatherPopup" id="Popup3" style="width: 950px">
          <h1>im tmrws3 forcast</h1>
        </div>
        <div class="WeatherPopup" id="Popup4" style="width: 950px">
          <h1>im tmrws 4 forcast</h1>
        </div>
        <div class="WeatherPopup" id="Popup5" style="width: 950px">
          <h1>im tmrws 5 forcast</h1>
        </div>
        <div class="col-2 m-4 FUTURE">
          <h3 class="float-end"></h3>
          <div class="row FUTURE">
            <div class="card" id="ForeCastCard1" style="width : 17rem;height : 9rem;">
              <button id="forecastBtn1" class="forecastBtn" onclick="openPopUpForecast(this)" value=1>
              <div class="card-body col">
                <img id="Day9WeatherIMG" src="IMG/rainy.png" alt="" height="100px" width="100px">
                <h5 class="card-title">Tomorrow</h5>
                <h6 class="card-subtitle mb-2 text-muted" id="Day9Weather">N/A</h6>
                <p class="card-text">Morning : Cloudy<br> Afternoon : Rainy <br>Evening : Rainy</p>
              </div>
            </button>
            </div>
            <div class="card mt-2" id="ForeCastCard2" style="width : 17rem;height : 9rem;">
              <button id="forecastBtn2" class="forecastBtn" onclick="openPopUpForecast(this)" value=2>
              <div class="card-body col">
                <img id="Day19WeatherIMG" src="IMG/cloud.png" alt="" height="100px" width="100px">
                <h5 class="card-title" id="DayOfWeek9">Unavailable</h5>
                <h6 class="card-subtitle mb-2 text-muted" id="Day19Weather">N/A</h6>
                <p class="card-text">Morning : N/A<br> Afternoon : N/A <br>Evening : N/A</p>
              </div>
            </button>
            </div>
            <div class="card mt-2" id="ForeCastCard3" style="width : 17rem;height : 9rem;">
              <button id="forecastBtn3" class="forecastBtn" onclick="openPopUpForecast(this)" value=3>
              <div class="card-body col">
                <img id="Day29WeatherIMG" src="IMG/sunny.png" alt="" height="100px" width="100px">
                <h5 class="card-title" id="DayOfWeek19">Unavailable</h5>
                <h6 class="card-subtitle mb-2 text-muted" id="Day29Weather">N/A</h6>
                <p class="card-text">Morning : N/A <br>Afternoon : N/A <br>Evening : N/A</p>
              </div>
            </button>
            </div>
            <div class="card mt-2" id="ForeCastCard4" style="width : 17rem;height : 9rem;">
              <button id="forecastBtn4" class="forecastBtn" onclick="openPopUpForecast(this)" value=4>
              <div class="card-body col">
                <img id="Day39WeatherIMG" src="IMG/sunny.png" alt="" height="100px" width="100px">
                <h5 class="card-title" id="DayOfWeek29">Unavailable</h5>
                <h6 class="card-subtitle mb-2 text-muted" id="Day39Weather">N/A</h6>
                <p class="card-text">Morning : N/A<br> Afternoon : N/A <br>Evening : N/A</p>
              </div>
            </button>
            </div>
            <div class="card mt-2" id="ForeCastCard5" style="width : 17rem;height : 9rem; ">
              <button id="forecastBtn5" class="forecastBtn" onclick="openPopUpForecast(this)" value=5>
              <div class="card-body col">
                <img src="IMG/rainy.png" alt="" height="100px" width="100px">
                <h5 class="card-title" id="DayOfWeek39">Unavailable</h5>
                <h6 class="card-subtitle mb-2 text-muted"id="Day6Weather">N/A</h6>
                <p class="card-text">Morning : N/A<br> Afternoon : N/A<br> Evening : N/A</p>
              </div>
            </button>
            </div>
          </div>
        </div>
      </div>
      <div class="row BOTTOMSEC">
        <div class="col-1">
            <button type="button" name="button" class="CORF" onclick="change_temp()" id="TEMPBUTTON" >F</button>
        </div>
        <div class="col-7 location_entry text-center">
            <label for="lOCATION"  style="font-size: 20px">Search your City</label>
            <input type="text" id="input_loc" value="" placeholder="City or State" size="50">
            <button type="button" name="button" id='CLIENT_LOC' onClick="newloc()">Search!</button>
        </div>
        <div class="col-2">
            <button type="button" name="button" class="REFRESH" onClick="window.location.reload()"><img src="IMG\Refresh_icon.svg.png" width=40px alt=""></button>
        </div>
      </div>
    </div>
    <script type="text/javascript">
    function SetTime() {
      var d = new Date()
        minutes = d.getMinutes().toString().length == 1 ? '0'+d.getMinutes() : d.getMinutes()
        hours = d.getHours().toString().length == 1 ? '0'+d.getHours() : d.getHours()
      return days = hours+':'+minutes;
    }
    function findCurrentDayOfWeek() {
      var d = new Date()
        day= d.getDay()
        let daysOfWeek = ['Sun', 'Mon', 'Tues', 'Wed', 'Thurs', 'Fri', 'Sat'];
      return daysOfWeek[day]
      
    }

    function showLocation(position) {
            return position
         }

    function setCurrentLocationData(position) {
        APIKEY = '8c15cb19dbc355d25ae5c4e0e088ede4'
        //api.openweathermap.org/data/2.5/forecast?lat={lat}&lon={lon}&appid={API key}
        ApiLatLonRequestURL = `https://api.openweathermap.org/data/2.5/forecast?lat=${position.coords.latitude}&lon=${position.coords.longitude}&appid=${APIKEY}&units=imperial`
        console.log(ApiLatLonRequestURL)
        $.getJSON(ApiLatLonRequestURL,function(data){
            LocationData = data
            let fourdays = ['9','19','29','39']
            for (i in fourdays) {
              DAY = fourdays[i]
              document.getElementById(`Day${DAY}Weather`).innerHTML = String(LocationData.list[DAY].weather[0].main);
              if (LocationData.list[DAY].weather[0].main == 'Clear') {
                document.getElementById(`Day${DAY}WeatherIMG`).src= "IMG/sunny.png";
              } else if (LocationData.list[DAY].weather[0].main == 'Rain') {
                document.getElementById(`Day${DAY}WeatherIMG`).src= "IMG/rainy.png";
              } else if (LocationData.list[DAY].weather[0].main == 'Clouds') {
                document.getElementById(`Day${DAY}WeatherIMG`).src= "IMG/cloud.png";
              } else {
                console.log('we couldnt find anything captain')
            }
          }
              document.getElementById("LOC").innerHTML = `${position.coords.latitude}, ${position.coords.longitude} (you)`
              document.getElementById("TEMPATURED").innerHTML = ' '+ String(parseInt(LocationData.list[0].main.temp)) + '°F'
              document.getElementById("HUMIDITY").innerHTML = String(parseInt(LocationData.list[0].main.humidity))
              document.getElementById("WINDINESS").innerHTML = String(parseInt(LocationData.list[0].wind.speed))

              document.getElementById("ChanceOfRain").innerHTML = (String(LocationData.list[0].pop * 100)).substr(0,2)

            TimeAPIKey = 'RS44HE9ZFROS'
            TimeApiURL = `http://api.timezonedb.com/v2.1/get-time-zone?by=position&lat=${LocationData.city.coord.lat}&lng=${LocationData.city.coord.lon}&key=${TimeAPIKey}&format=json`
            fetch(TimeApiURL).then((response) => response.json()).then((data) => 
              document.getElementById("currentTimes").innerHTML =findCurrentDayOfWeek() + data.formatted.substr(10, 6) + ' ' +data.abbreviation
            )
          });

    }

    
    
    function FirstLoadCurrentData() {
      //set current day of week and time
      document.getElementById("currentTimes").innerHTML = findCurrentDayOfWeek() + ' ' + SetTime()

      //future days of week
      let daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday','Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      let fourdays = ['9','19','29','39']
      var dayofweek = new Date()
      theday= dayofweek.getDay()
      theday = theday +1
      for (i in fourdays) {
        theday = theday + 1
        nextdayofweek = daysOfWeek[theday]
        document.getElementById(`DayOfWeek${fourdays[i]}`).innerHTML = nextdayofweek;

      navigator.geolocation.getCurrentPosition(setCurrentLocationData);

      
      }
    }
    

    FirstLoadCurrentData()

    function change_temp() {
        var thetemp = document.getElementById("TEMPATURED").innerHTML;
        tempCURRENT = thetemp.replace(/\D/g,'');
        console.log('START :' + thetemp + ' AFTER: ' + tempCURRENT)
        var button = document.getElementById("TEMPBUTTON");

        if (thetemp.substr(thetemp.length - 1) == 'F') {
          var Ctemp = math.round((Number(tempCURRENT)- 32) * .5556 );
          console.log('CONVERSION IS' + Ctemp)
          button.innerHTML = 'C';
          document.getElementById("TEMPATURED").innerHTML = ' '+ Ctemp + '°C';
          } else {
            var Ftemp = math.round((Number(tempCURRENT) * 1.8) +32)
            button.innerHTML = 'F';
            document.getElementById("TEMPATURED").innerHTML = ' '+ Ftemp + '°F';
        }
      }



    

    function newloc() {
      ClientInputLoc = document.getElementById("input_loc").value.toLowerCase()
      APIKEY = '8c15cb19dbc355d25ae5c4e0e088ede4'
      ApiLatLonRequestURL = `https://api.openweathermap.org/data/2.5/forecast?q=${ClientInputLoc}&appid=${APIKEY}&units=imperial`
      //ApiLatLonRequestURL = `https://api.openweathermap.org/data/2.5/weather?q=${ClientInputLoc}&appid=${APIKEY}&units=imperial`
      $.getJSON(ApiLatLonRequestURL,function(data){
          LocationData = data
          console.log(LocationData)
          let fourdays = ['9','19','29','39']
          for (i in fourdays) {
            DAY = fourdays[i]
            document.getElementById(`Day${DAY}Weather`).innerHTML = String(LocationData.list[DAY].weather[0].main);
            if (LocationData.list[DAY].weather[0].main == 'Clear') {
              document.getElementById(`Day${DAY}WeatherIMG`).src= "IMG/sunny.png";
            } else if (LocationData.list[DAY].weather[0].main == 'Rain') {
              document.getElementById(`Day${DAY}WeatherIMG`).src= "IMG/rainy.png";
            } else if (LocationData.list[DAY].weather[0].main == 'Clouds') {
              document.getElementById(`Day${DAY}WeatherIMG`).src= "IMG/cloud.png";
            } else {
              console.log('we couldnt find anything captain')
          }
        }
            document.getElementById("LOC").innerHTML = ClientInputLoc.replace(/(^\w{1})|(\s+\w{1})/g, letter => letter.toUpperCase());
            if (document.getElementById("TEMPBUTTON").innerHTML == 'F') {document.getElementById("TEMPATURED").innerHTML =' '+ String(parseInt(LocationData.list[0].main.temp)) + '°F'}
            else {document.getElementById("TEMPATURED").innerHTML =' '+ math.round((Number(parseInt(LocationData.list[0].main.temp))- 32) * .5556 ) + '°C'}
              
            document.getElementById("HUMIDITY").innerHTML = String(parseInt(LocationData.list[0].main.humidity))
            document.getElementById("WINDINESS").innerHTML = String(parseInt(LocationData.list[0].wind.speed))
            document.getElementById("ChanceOfRain").innerHTML = (String(LocationData.list[0].pop * 100)).substr(0,2)

        TimeAPIKey = 'RS44HE9ZFROS'
        TimeApiURL = `http://api.timezonedb.com/v2.1/get-time-zone?by=position&lat=${LocationData.city.coord.lat}&lng=${LocationData.city.coord.lon}&key=${TimeAPIKey}&format=json`
        fetch(TimeApiURL).then((response) => response.json()).then((data) => 
          document.getElementById("currentTimes").innerHTML =findCurrentDayOfWeek() + data.formatted.substr(10, 6) + ' ' +data.abbreviation
        )
        });
      }
      
      function openPopUpForecast(e) {
        g = 0
          while (g<5) {
            g++
            console.log(document.getElementById(`Popup${g}`) + ' is ' + g)
            RemoveClasses  = document.getElementById(`Popup${g}`)
            RemoveClasses.classList.remove("openWeatherPopup")
            console.log(g + 'is')
            document.getElementById(`ForeCastCard${g}`).style.backgroundColor = ``;
            document.getElementById(`forecastBtn${g}`).setAttribute( "onClick", "openPopUpForecast(this)" )
          }
        console.log('I WAS RAN 2')
        popup = document.getElementById(`Popup${e.value}`)
        popup.classList.add("openWeatherPopup")  
        document.getElementById(`forecastBtn${e.value}`).setAttribute( "onClick", "closePopUpForecast(this)" )
        document.getElementById(`ForeCastCard${e.value}`).style.backgroundColor = `#74d5e8`;
      }

      function closePopUpForecast(e) {
        g = 0
        while (g<5) {
            g++
            console.log(document.getElementById(`forecastBtn${g}`) + ' is ' + g)
            RemoveClasses  = document.getElementById(`forecastBtn${g}`)
            document.getElementById(`forecastBtn${g}`).setAttribute( "onClick", "openPopUpForecast(this)" )
            console.log(g + 'is')
          }
        document.getElementById(`ForeCastCard${e.value}`).style.backgroundColor = ``
        console.log(e.value + ' - 2')
        popup.classList.remove("openWeatherPopup")
        document.getElementById(`forecastBtn${e.value}`).setAttribute( "onClick", "openPopUpForecast(this)" )

      }

    </script>
    
  </body>
</html>
